<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="title" content="Mega Doll" />
    <meta name="description" content="music for broken doll aesthetic accidents, evident pizza stains, more accidents and oh yes forgot about music for unintended consequences" />
        <!-- Primary Meta Tags end -->

    <!-- Open Graph / Facebook -->
<meta property="og:type" content="website" />
<meta property="og:url" content="https://megadoll.club/" />
<meta property="og:title" content="Mega Doll" />
<meta property="og:description" content="music for broken doll aesthetic accidents, evident pizza stains, more accidents and oh yes forgot about music for unintended consequences" />
<meta property="og:image" content="assets/img/Mega Doll - Puntiac.jpg" />

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:url" content="https://megadoll.club/" />
<meta property="twitter:title" content="Mega Doll" />
<meta property="twitter:description" content="music for broken doll aesthetic accidents, evident pizza stains, more accidents and oh yes forgot about music for unintended consequences" />
<meta property="twitter:image" content="assets/img/Mega Doll - Puntiac.jpg" />
  

  <!-- PLEASE NO CHANGES BELOW THIS LINE (UNTIL I SAY SO) -->
  <script language="javascript" type="text/javascript" src="libraries/p5.min.js"></script>
  <script language="javascript" type="text/javascript" src="animacionbarradenavegacion.js"></script>
  
  
  <script language="javascript" type="text/javascript" src="navbar.js"></script>
  <script language="javascript" type="text/javascript" src="security.js"></script>
  
  <!-- OK, YOU CAN MAKE CHANGES BELOW THIS LINE AGAIN -->
  
  <script src="security.js"></script>

  <title>Mega Doll - Musical Artist</title>
  <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.cdnfonts.com/css/evilz" rel="stylesheet">

<!-- inicio Prevenir la desactivacion de JavaScript -->
<script src="security - check-js.js"></script>
    <noscript>
        <meta http-equiv="refresh" content="0;url=/security - habilita-js.html">
    </noscript>
<!-- fin Prevenir la desactivacion de JavaScript -->
  

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruby</title>
    <style>
        /* --- Estilos Generales --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #9C9AAD;
            color: #FFFFFF;
            margin: 0;
            padding: 2rem;
        }
        .container {
            max-width: responsive;
            margin: 0 auto;
            background-color: #F1F1F1;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }
        h1 {
            text-align: center;
            color: #43558C;
        }
        /* --- Estilos para el Toggle --- */
        .toggle-button {
            background-color: #2D3558;
            color: #57C4DD;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 18px;
            transition: background-color 0.3s ease;
            margin-top: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .toggle-button:hover {
            background-color: #243871;
        }
        .toggle-button::after {
            content: '+';
            font-size: 22px;
            color: #E8F8F9;
            float: right;
            margin-left: 5px;
        }
        .toggle-button.active::after {
            content: "−";
        }
        /* --- Estilos para el Contenido del Toggle --- */
        .toggle-content {
            padding: 0 18px;
            background-color: #9291A3;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            border-left: 1px solid #ddd;
            border-right: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px;
        }
        .toggle-content p {
            line-height: 1.6;
            color: #2D3558; /* Color de texto para el párrafo */
        }
        /* --- Estilos para los Bloques de Código --- */
        pre {
            background-color: #3F5085;
            color: #3CBDF1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: "Courier New", Courier, monospace;
            font-size: 14px;
            padding-top: 35px; /* Espacio para el botón de copiar */
        }
        code {
            font-family: inherit;
        }
        /* --- Contenedor para el bloque de código (para posicionar el botón) --- */
        .code-container {
            position: relative;
            margin: 1rem 0;
        }
        /* --- Estilo para el botón de copiar --- */
        .copy-button {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: #6698CA;
            color: #2D3558;
            border: none;
            padding: 6px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            opacity: 0.8;
            transition: all 0.2s ease;
        }
        .copy-button:hover {
            opacity: 1;
        }
    </style>
    </head>
<body class="body-snocomm">

    <div class="container">
        <h1>Snocomm - Secure Coding</h1>

        <button class="toggle-button">Strings: the dangers of improper string construction</button>
        <div class="toggle-content">
            <p>
                To make your code a reusable cybersecurity template, you should structure it to demonstrate the dangers of improper string construction, a common source of injection vulnerabilities.
                The best way to do this is to create a class that shows both an insecure and a secure way to build a command string from input parts. This highlights the core cybersecurity principle of input sanitization.
            </p>
            <div class="code-container">
                
                
            </div>
            <p><b>Insecure Version (The Vulnerable Pattern)</b></p>
            <p>This first example mirrors what i consider is your original code's logic but applies it to a common cybersecurity scenario: building a shell command. It directly concatenates input, making it vulnerable to <b>Command Injection</b>.</p>
            <div class="code-container">
                <button class="copy-button">Copiar</button>
                <pre><code>hash = { key1: "val2", key2: "val2" }
string = ""
hash.each { |k, v| string << "#{k} is #{v}\n" }
puts string</code></pre>
            </div>

            

            <div class="code-container">
                <button class="copy-button">Copiar</button>
                <pre><code># WARNING: This code is intentionally VULNERABLE for educational purposes.
# Do NOT use this pattern in production code.

puts "--- 1. Insecure Command Builder ---"

# Malicious input simulating what an attacker might provide
malicious_input = {
  file: "report.txt; rm -rf /",
  user: "attacker"
}

# The program builds a command string by directly concatenating the input
command_string = "process_file --file="
command_string << malicious_input[:file]
command_string << " --user="
command_string << malicious_input[:user]

puts "Generated Command: #{command_string}"
# Output: process_file --file=report.txt; rm -rf / --user=attacker
# This would run the intended command AND the dangerous 'rm -rf /' command.</code></pre>
            </div>

            <p><b>Secure & Reusable Template</b></p>
            <p>This version refactors the logic into a reusable class. It uses a library designed to safely handle shell arguments, preventing injection attacks. This is the <b>correct and secure</b> approach.</p>

            <div class="code-container">
                <button class="copy-button">Copiar</button>
                <pre><code>require 'shellwords'

# A reusable class for building shell commands securely.
class CommandBuilder
  attr_reader :base_command

  def initialize(base_command)
    @base_command = base_command
    puts "\n--- 2. Secure Command Builder ---"
  end

  # Builds a command by securely escaping each argument.
  # This prevents command injection.
  def build_securely(arguments_hash)
    # Start with the base command, already split for safety.
    command_parts = Shellwords.split(@base_command)

    # Escape and append each part from the input hash.
    arguments_hash.each do |key, value|
      command_parts << "--#{key}"
      command_parts << value.to_s # Shellwords will handle the escaping
    end

    # The 'shelljoin' method ensures all parts are safely quoted.
    return Shellwords.join(command_parts)
  end
end

# --- Usage Example ---

# Malicious input, same as before
malicious_input = {
  file: "report.txt; rm -rf /",
  user: "attacker"
}

# 1. Instantiate the builder with a base command
builder = CommandBuilder.new("process_file")

# 2. Build the command string using the secure method
safe_command = builder.build_securely(malicious_input)

# 3. Print the result
puts "Generated Command: #{safe_command}"
# Output: process_file --file 'report.txt; rm -rf /' --user 'attacker'
# The malicious part is now treated as a single, harmless string argument.</code></pre>
            </div>

            <p><b>Putting It All Together: A New Use Case</b></p>
            <p>Here is a complete example showing how to reuse the template to build a grep command.</p>
            <div class="code-container">
                <button class="copy-button">Copiar</button>
                <pre><code>require 'shellwords'

# The CommandBuilder class remains unchanged.
class CommandBuilder
  attr_reader :base_command

  def initialize(base_command)
    @base_command = base_command
  end

  def build_securely(arguments_hash)
    command_parts = Shellwords.split(@base_command)
    arguments_hash.each do |key, value|
      command_parts << "--#{key}"
      command_parts << value.to_s
    end
    return Shellwords.join(command_parts)
  end
end

# --- Reusing the Template ---

puts "--- Building a 'grep' command ---"

# 1. Set a NEW base command
grep_builder = CommandBuilder.new("grep")

# 2. Define NEW arguments for the 'grep' command
grep_args = {
  pattern: "API_KEY", 
  file: "/etc/secrets.conf; cat /etc/passwd" # Simulating malicious input
}

# 3. Build the new command securely
safe_grep_command = grep_builder.build_securely(grep_args)

# 4. Print the new, safe command
puts "Generated Command: #{safe_grep_command}"
# Output: grep --pattern 'API_KEY' --file '/etc/secrets.conf; cat /etc/passwd'</code></pre>
            </div>
            
            <p><b>Using the template: A More Flexible CommandBuilder</b></p>
            <div class="code-container">
                <button class="copy-button">Copiar</button>
                <pre><code>require 'shellwords'

# MODIFIED CommandBuilder class
class CommandBuilder
  attr_reader :base_command

  def initialize(base_command)
    @base_command = base_command
  end

  # MODIFIED to handle both options and a list of positional arguments
  def build_securely(options_hash: {}, positional_args: [])
    # Start with the base command
    command_parts = Shellwords.split(@base_command)

    # 1. Handle key-value options
    options_hash.each do |key, value|
      command_parts << "--#{key}"
      command_parts << value.to_s
    end

    # 2. Handle the list of positional arguments
    positional_args.each do |arg|
        command_parts << arg
    end

    # Safely join everything into the final command string
    return Shellwords.join(command_parts)
  end
end

# --- New Usage Example ---

puts "--- Building a 'grep' command with multiple files ---"

# 1. Instantiate the builder (no change here)
grep_builder = CommandBuilder.new("grep")

# 2. Define your arguments. You can now define your files
#    vertically in an array, just as you wanted! ✅
files_to_search = [
  "/var/log/app1.log",
  "/var/log/app2.log",
  "/var/log/app3.log",
  "/var/log/malicious_input; reboot", # Malicious input
  "/var/log/app4.log"
]

# 3. Build the command using the new method signature
#    The pattern is a regular option, and the files are positional arguments.
safe_grep_command = grep_builder.build_securely(
  options_hash: { pattern: "ERROR" },
  positional_args: files_to_search
)

# 4. Print the correctly formatted and safe command
puts "Generated Command: #{safe_grep_command}"</code></pre>
            </div>

            <p><b>Another approach: Searching Directories Recursively</b></p>
            <div class="code-container">
                <button class="copy-button">Copiar</button>
                <pre><code>require 'shellwords'

# The CommandBuilder class remains unchanged.
class CommandBuilder
  attr_reader :base_command

  def initialize(base_command)
    @base_command = base_command
  end

  def build_securely(options_hash: {}, positional_args: [])
    command_parts = Shellwords.split(@base_command)

    options_hash.each do |key, value|
      # This logic handles both long flags (--key) and short flags (-key)
      flag = key.length == 1 ? "-#{key}" : "--#{key}"
      command_parts << flag
      # Add the value only if it's not a boolean flag (like -r)
      command_parts << value.to_s unless value == true
    end

    positional_args.each do |arg|
        command_parts << arg
    end

    return Shellwords.join(command_parts)
  end
end

# --- Usage Example for Searching Directories ---

puts "--- Building a recursive 'grep' command for directories ---"

# 1. Instantiate the builder (no change)
grep_builder = CommandBuilder.new("grep")

# 2. Define the directories to search.
#    You can list them vertically just like before. ✅
directories_to_search = [
  "/etc/nginx",
  "/var/log/",
  "/home/user/documents; rm -rf /", # Malicious input
  "/opt/app/config"
]

# 3. Build the command.
#    - Add 'r: true' to the options hash to enable recursive search.
#    - Pass the directory list as positional arguments.
safe_grep_command = grep_builder.build_securely(
  options_hash: { r: true, pattern: "API_KEY" },
  positional_args: directories_to_search
)

# 4. Print the final, safe command.
puts "Generated Command: #{safe_grep_command}"</code></pre>
<p></p>
            </div>
        </div>
    </div>






    <script>
        // --- Lógica de JavaScript para los Toggles ---
        const buttons = document.querySelectorAll('.toggle-button');
        buttons.forEach(button => {
            button.addEventListener('click', function () {
                this.classList.toggle('active');
                const content = this.nextElementSibling;
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                }
            });
        });

        // --- Lógica de JavaScript para el Botón de Copiar ---
        const copyButtons = document.querySelectorAll('.copy-button');
        copyButtons.forEach(button => {
            button.addEventListener('click', () => {
                const preBlock = button.nextElementSibling;
                const codeBlock = preBlock.querySelector('code');
                navigator.clipboard.writeText(codeBlock.innerText).then(() => {
                    button.textContent = '¡Copiado!';
                    button.style.backgroundColor = '#EA428B';
                    setTimeout(() => {
                        button.textContent = 'Copiar';
                        button.style.backgroundColor = '#6698CA';
                    }, 2000);
                }).catch(err => {
                    console.error('Error al copiar el texto: ', err);
                });
            });
        });
    </script>

</body>
</html>